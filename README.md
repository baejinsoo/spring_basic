# spring_basic

### 비즈니스 요구사항과 설계

#### 회원

>[git commit](https://github.com/baejinsoo/spring_basic/commit/11c2f1e25d7dcebc8ee9ba74b91ffa7ee6bf2785)
>
>[test commit](https://github.com/baejinsoo/spring_basic/commit/d510a3e23e546743d8287c43fe392f3b3efea73c)

- 회원을 가입하고 조회할 수 있다.
- 회원은 일반과 VIP 두 가지 등급이 있다.
- 회원 데이터는 자체 DB를 구축할 수 있고, 외부 시스템과 연동할 수 있다.

#### 주문과 할인 정책

> [git commit](https://github.com/baejinsoo/spring_basic/commit/cac74e7d7cd6e6e612e56eba636f721be7a1cbf3)

- 회원은 상품을 주문할 수 있다.
- 회원 등급에 따라 할인 정책을 적용할 수 있다.
- 할인 정책은 모든 VIP는 1000원을 할인해주는 고정 금액 할인을 적용한다. (후에 변경 가능)
- 할인 정책은 변경 가능성이 높다. 회사의 기본 할인 정책을 아직 정하지 못했고, 오픈 직전까지 고민을 미루고 싶다. 최악의 경우 할인을 적용하지 않을 수 있다.(미확정)



### 새로운 할인 정책 개발

 새로운 할인 정책을 확장해보자.

- vip 1000원 고정 금액 할인 => 금액당 %할인

**AppConfig 생성**

애플리케이션의 전체 동작 방식을 구성(config)하기 위해, 구현 객체를 생성하고, 연결하는 책임을 가지는 별도의 설정 클래스를 생성해서 DIP 해결(구현객체에는 의존하지 않고 인터페이스에만 의존하도록 변경)

👉 AppConfig는 구체 클래스를 선택한다. 애플리케이션이 어떻게 동작할지 전체 구성을 책임짐



### 스프링 컨테이너 생성 및 조회

> [git commit](https://github.com/baejinsoo/spring_basic/commit/86fc01d12ca95c02416beffe2eb8d775324e0415)

```java
// 스프링 컨테이너 생성
ApplicationContext applicationContext = 
new AnnotationConfigApplicationContext(AppConfig.class);
```

- `ApplicationContext` 를 스프링 컨테이너 라고 한다.
- `ApplicationContext`는 인터페이스이다.

![image](https://user-images.githubusercontent.com/17541671/110237456-8d1d1680-7f7f-11eb-9c6b-e4030f5b8f59.png)

- BeanFactory
  - 스프링 컨테이너의 최상위 인터페이스
  - 스프링 빈을 관리하고 조회하는 역할을 담당
  - getBean() 제공
- ApplicaitonContext
  - BeanFactory 의 기능을 모두 상속받아서 제공
  - 부가기능 제공
    - 메시지 소스를 활용한 국제화 기능
    - 환경변수
    - 애플리케이션 이벤트
    - 편리한 리소스 조회



### 싱글톤 컨테이너

- 스프링 없는 순수한 DI 컨테이너는 요청을 할 때마다 객체를 새로 생성한다.

- 예시로 고객 트래픽이 초당 1000이 나오면 초당 1000개의 객체가 생성되고 소멸된다. 

  👉 메모리 낭비가 심하다.

- 해결방안은 해당 객체가 1개만 생성되고, 공유하도록 설계 👉 싱글톤 패턴



#### 싱글톤 패턴

- 클래스의 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인 패턴
- private 생성자를 생성해서 외부에서 임의로 new 키워드를 사용하지 못하도록 막는다.
- static 영역에 객체 instance를 미리 하나 생성해서 올려둔다
- 이 객체 인스턴스가 필요하면 오직 `getInstance()` 메서드를 통해서만 조회가능, 이 메서드를 통해 항상 같은 인스턴스를 반환하도록



#### 싱글톤 패턴의 단점

- 싱글톤 패턴을 구현하는 코드 자체가 많이 필요

- 의존관계상 클라이언트가 구체 클래스에 의존 👉 DIP 위반

- 클라이언트가 구체 클래스에 의존해서 OCP 원칙을 위반할 가능성이 높아짐.

- 테스트하기 어렵다.

  👉 인스턴스를 미리 받아와서 설정이 끝나버리기 때문에 유연학 테스트 하기 어려움

- 내부 속성을 변경하거나 초기화 하기 어렵다
- private 생성자를 쓰기때문에 자식 클래스를 만들기 어렵다.



#### 싱글톤 컨테이너

> 스프링 컨테이너는 싱글톤 패턴의 문제점을 해결하면서, 객체 인스턴스를 싱글톤으로 관리한다.

- 스프링 컨테이너는 싱글톤 패턴을 적용하지 않아도, 객체 인스턴스를 싱글톤으로 관리한다.
- 스프링 컨테이너는 싱글톤 컨테이너 역할을 함. 이렇게 싱글톤 객체를 생성하고 관리하는 기능을 싱글톤 레지스트리라고 함.

👉 싱글톤 패턴을 위한 지저분한 코드가 들어가지 않아도 됨.

​	  DIP, OCP, 테스트, private 생성자로부터 자유롭게 싱글톤을 사용할 수 있다.